<!DOCTYPE html>
<html>

<head>
    <title>æ—…æ¸¸å’¨è¯¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#00B42A',
                        neutral: '#F5F5F5',
                        'neutral-dark': '#E5E5E5',
                        warning: '#FF7D00',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer components {
            .end-chat-button {
                @apply bg-red-500 text-white py-3 px-4 rounded-lg w-full hover:bg-red-600 transition-all duration-300 transform-gpu;
            }
            
            .system-message {
                @apply bg-gray-200 text-gray-600 py-1.5 px-3 rounded-full text-xs mx-auto my-2.5 max-w-[60%] text-center;
            }
            
            .interaction-hint {
                @apply fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-primary/90 text-white py-2 px-4 rounded-full text-sm shadow-lg z-50 opacity-0 transition-opacity duration-300;
            }
            
            .hint-visible {
                @apply opacity-100;
            }
            
            .modal {
                @apply fixed inset-0 bg-black/50 flex items-center justify-center z-50 opacity-0 pointer-events-none transition-opacity duration-300;
            }
            
            .modal-content {
                @apply bg-white rounded-xl p-6 max-w-xs w-full mx-4 transform scale-95 transition-all duration-300;
            }
            
            .modal-visible {
                @apply opacity-100 pointer-events-auto;
            }
            
            .modal-visible .modal-content {
                @apply scale-100;
            }
            
            .scenario-box {
                @apply bg-blue-50 border-l-4 border-blue-400 p-4 mb-6 rounded;
            }
            
            .warning-box {
                @apply bg-warning/10 border border-warning/30 text-warning p-4 mb-6 rounded;
            }
        }

        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .chat-bubble-user {
                @apply bg-primary text-white rounded-tl-lg rounded-tr-lg rounded-bl-lg;
            }

            .chat-bubble-bot {
                @apply bg-neutral-dark text-gray-800 rounded-tl-lg rounded-tr-lg rounded-br-lg;
            }

            .typing-indicator {
                @apply flex space-x-1 animate-pulse;
            }

            .typing-dot {
                @apply w-2 h-2 bg-gray-400 rounded-full;
            }

            .countdown {
                @apply bg-green-50/10 border border-green-500/30 text-green-500 px-3 py-1 rounded-full text-xs inline-block;
            }
            
            .message-button {
                @apply bg-gray-100 hover:bg-gray-200 transition-colors duration-200;
            }
            
            .autosize-textarea {
                @apply resize-none overflow-hidden w-full max-w-[80%] mx-auto;
            }
            
            .small-text {
                @apply text-sm;
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen font-sans">
    <div id="scenario-page" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="text-center mb-6">
                <h1 class="text-2xl font-bold text-gray-800 mb-2">æ—…æ¸¸å’¨è¯¢</h1>
                <p class="text-gray-600">ä¸å®¢æœå¯¹è¯è·å–è¡Œç¨‹å»ºè®®</p>
            </div>

            <div class="scenario-box">
                <p class="text-gray-700"> <!-- ç§»é™¤ small-text ç±»ï¼Œä¿æŒåŸæœ‰å¤§å° -->
                    <strong>æƒ…å¢ƒ:</strong> æ‚¨æ­£åœ¨è®¡åˆ’ä¸€åœºä»åŒ—äº¬å‡ºå‘ä¸ºæœŸä¸‰å¤©çš„æ—…ç¨‹ï¼Œæ‚¨è¿˜æœ‰å……è£•çš„æ—¶é—´è€ƒè™‘ã€å†³å®šæ—…æ¸¸ç›®çš„åœ°å¹¶å®Œæˆå¤§è‡´è¡Œç¨‹å®‰æ’ã€‚ä¸ºäº†é«˜æ•ˆå†³ç­–ï¼Œå¹¶äº†è§£ç›¸å…³çš„æ—…æ¸¸èµ„è®¯ï¼Œæ‚¨æ‰“å¼€æ—…æ¸¸å¹³å°ï¼Œè¿›å…¥å®¢æœå’¨è¯¢ç•Œé¢ã€‚
                </p>
            </div>

            <div class="bg-green-50 border border-green-500/30 p-4 mb-6 rounded">
                <p class="text-gray-700 font-medium text-green-500"> <!-- ç§»é™¤ small-text ç±»ï¼Œä¿æŒåŸæœ‰å¤§å° -->
                    <i class="fa fa-clock-o mr-2"></i>æ—¶é—´å……è£•ï¼šæ‚¨è¿˜æœ‰è®¸å¤šæ—¶é—´å¯ä»¥å¥½å¥½å®‰æ’è¡Œç¨‹ï¼
                </p>
            </div>

            <button id="start-chat" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition duration-300 ease-in-out">
                å¼€å§‹å¯¹è¯
            </button>
        </div>
    </div>

    <div id="phone-container" class="fixed inset-0 bg-gray-900/80 z-40 flex items-center justify-center p-4 hidden">
        <div class="relative bg-white rounded-3xl shadow-2xl w-full max-w-xs overflow-hidden border-8 border-gray-800">
            <!-- æ‰‹æœºé¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="bg-gray-800 text-white text-xs flex items-center justify-between px-4 py-1.5">
                <span>9:41 AM</span>
                <div class="flex items-center space-x-1">
                    <i class="fa fa-signal"></i>
                    <i class="fa fa-wifi"></i>
                    <i class="fa fa-battery-three-quarters"></i>
                </div>
            </div>

            <!-- èŠå¤©åº”ç”¨æ ‡é¢˜æ  -->
            <div class="bg-primary text-white py-3 px-4 flex items-center">
                <i class="fa fa-arrow-left mr-3 cursor-pointer"></i>
                <div>
                    <h2 class="font-medium small-text">AIå°æ—…</h2>
                    <p class="text-xs opacity-80">æ™ºèƒ½æ—…æ¸¸åŠ©æ‰‹</p>
                </div>
                <div class="ml-auto">
                    <span class="countdown text-green-500"><i class="fa fa-clock-o mr-1"></i>æ—¶é—´å……è£•</span>
                </div>
            </div>

            <!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
            <div id="chat-container" class="h-[calc(100vh-240px)] max-h-[500px] overflow-y-auto p-3 bg-gray-50 flex flex-col">
                <!-- èŠå¤©å†…å®¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="border-t border-gray-200 p-2 flex items-center">
                <button class="text-gray-500 mr-2">
                    <i class="fa fa-plus-circle text-lg"></i>
                </button>
                <div class="relative flex-grow flex justify-center">
                    <textarea id="message-input" placeholder="ç‚¹å‡»æ­¤å¤„å‘é€æ¶ˆæ¯" class="autosize-textarea py-1.5 px-3 rounded-lg bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/30 cursor-pointer message-button text-sm" readonly></textarea>
                    <button id="send-button" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-primary opacity-0 cursor-default">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- äº¤äº’æç¤º -->
        <div id="interaction-hint" class="interaction-hint">
            <i class="fa fa-hand-pointer-o mr-1"></i> ç‚¹å‡»ä¸‹æ–¹å¯¹è¯æ¡†ç»§ç»­å¯¹è¯
        </div>
    </div>

    <!-- ç»“æŸå¯¹è¯æ¨¡æ€æ¡† -->
    <div id="end-chat-modal" class="modal">
        <div class="modal-content">
            <div class="text-center mb-4">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 text-red-500 mb-4">
                    <i class="fa fa-comments-o text-2xl"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-800 mb-2">ç»“æŸå¯¹è¯</h3>
                <p class="text-gray-600 small-text">ç¡®å®šè¦ç»“æŸå½“å‰å¯¹è¯å—ï¼Ÿ</p>
            </div>
            <div class="flex space-x-3">
                <button id="cancel-end-chat" class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-lg cursor-not-allowed opacity-50" disabled>
                    å–æ¶ˆ
                </button>
                <button id="confirm-end-chat" class="flex-1 end-chat-button">
                    ç»“æŸå¯¹è¯
                </button>
            </div>
        </div>
    </div>

    <script>
        // å¯¹è¯å†…å®¹ï¼ˆæ–°çš„å¯¹è¯æµç¨‹ï¼‰
        const conversations = [
            { user: 'æˆ‘äººåœ¨åŒ—äº¬ï¼Œæœ€è¿‘æœ‰ä¸‰å¤©å‡ï¼Œæƒ³å‡ºå»æ—…æ¸¸ä½†è¿˜æ²¡ä»»ä½•è§„åˆ’ã€‚ä½ èƒ½æ¨èå‡ ä¸ªç›®çš„åœ°å—ï¼Ÿæˆ‘ä»¬ä¸ç€æ€¥åšå†³å®šï¼Œæƒ³å…ˆå¤šäº†è§£ä¸€ä¸‹ã€‚', bot: 'å¥½çš„ï½ä¸‰å¤©æ—¶é—´ä»åŒ—äº¬å‡ºå‘ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨æ¨èå‡ æ¡çƒ­é—¨è·¯çº¿ğŸ˜Šè¯·é—®æ‚¨æ˜¯æ‰“ç®—ç‹¬è‡ªå‡ºè¡Œï¼Œè¿˜æ˜¯å’Œå®¶äººæˆ–æœ‹å‹ä¸€èµ·ï¼Ÿ' },
            { user: 'ä¸¤ä¸ªäººï¼Œæœ‹å‹ã€‚', bot: 'äº†è§£äº†ï¼Œé‚£æˆ‘æ¨èä»¥ä¸‹å‡ ä¸ªç›®çš„åœ°ä¾›æ‚¨é€‰æ‹©ï¼š<br>1. ğŸ–ï¸ **é’å²›**ï¼šæµ·è¾¹åŸå¸‚ï¼Œé€‚åˆæ”¾æ¾å’Œç¾é£Ÿä¹‹æ—…ï¼Œä¸‰å¤©è¶³å¤Ÿå®‰æ’åƒå–ç©ä¹ã€‚<br>2. ğŸ¯ **æ‰¿å¾·**ï¼šå¯ä»¥å‚è§‚é¿æš‘å±±åº„ã€ä½“éªŒæ¸…ä»£çš‡å®¶æ–‡åŒ–ï¼ŒèŠ‚å¥è½»æ¾ã€‚<br>3. ğŸ™ï¸ **è¥¿å®‰**ï¼šå†å²æ°”æ¯æµ“åšï¼Œå…µé©¬ä¿‘ã€å¤§å”ä¸å¤œåŸç­‰éƒ½å¾ˆé€‚åˆçŸ­æœŸæ–‡åŒ–æ¸¸ã€‚' },
            { user: 'æˆ‘ä»¬ä¸æƒ³å¤ªèµ¶è·¯ï¼Œæœ€å¥½é«˜é“ä¸‰ä¸ªå°æ—¶ä»¥å†…å°±èƒ½åˆ°çš„ã€‚', bot: 'æ˜ç™½ï½é‚£é’å²›å’Œæ‰¿å¾·æ˜¯æ¯”è¾ƒåˆé€‚çš„é€‰æ‹©ï¼Œéƒ½æœ‰é«˜é“ç›´è¾¾ï¼Œ3å°æ—¶å†…å¯è¾¾ğŸš„æ‚¨æ›´åå¥½çœ‹æµ·ã€é€›å¸‚åŒºï¼Œè¿˜æ˜¯æƒ³èµ°æ–‡è‰ºè·¯çº¿ï¼Ÿ' },
            { user: 'åä¼‘é—²ä¸€ç‚¹ï¼Œæœ‰åƒçš„æœ‰æ™¯ç‚¹å°±å¥½ã€‚', bot: 'é‚£æˆ‘å»ºè®®é¦–é€‰**é’å²›**ã€‚æ¨èå¤§è‡´è·¯çº¿å¦‚ä¸‹ï¼š<br>ç¬¬ä¸€å¤©ï¼šç«è½¦åˆ°è¾¾ï¼Œæ ˆæ¡¥ã€æµ·è¾¹æ­¥è¡Œè¡—æ•£æ­¥ï¼›<br>ç¬¬äºŒå¤©ï¼šå…«å¤§å…³ã€å°é±¼å±±ï¼Œæ™šä¸Šåœ¨å°ä¸œå¤œå¸‚å°æµ·é²œï¼›<br>ç¬¬ä¸‰å¤©ï¼šä¿¡å·å±±ã€é’å²›å•¤é…’åšç‰©é¦†ï¼Œç„¶åè¿”å›ã€‚' },
            { user: 'ä¸é”™ä¸é”™ï¼ä½å®¿æœ‰ä»€ä¹ˆæ¨èå—ï¼Ÿ', bot: 'ğŸ¨ é’å²›æµ·æ™¯å…¬å¯“ï¼šÂ¥450/æ™šï¼Œé è¿‘æ ˆæ¡¥ï¼Œé€‚åˆæœ‹å‹ç»“ä¼´ï¼›<br>ğŸ›ï¸ å°ä¸œå¿«æ·é…’åº—ï¼šÂ¥320/æ™šï¼Œå‘¨å›´åƒå–æ–¹ä¾¿ï¼›<br>ğŸ¡ æ°‘å®¿ç²¾é€‰ï¼šÂ¥480/æ™šï¼Œæœ‰äº›æ˜¯å¸¦é˜³å°æµ·æ™¯æˆ¿å“¦ï½' },
            { user: 'æˆ‘ä»¬æ¯”è¾ƒå–œæ¬¢ä½å¾—èˆ’æœä¸€ç‚¹çš„ã€‚', bot: 'é‚£æˆ‘å»ºè®®é€‰æ‹©é’å²›æµ·æ™¯å…¬å¯“ï¼Œä½ç½®å¥½ã€è¯„ä»·é«˜ï¼Œå¾ˆå¤šå¹´è½»äººé€‰æ‹©è¿™é‡Œï½æ˜¯å¦éœ€è¦æˆ‘å¸®æ‚¨é¢„çº¦ï¼Ÿ' },
            { user: 'æˆ‘ä»¬ä¸ç€æ€¥ï¼Œè¿˜è¦å†å¤šè€ƒè™‘è€ƒè™‘ï¼Œä¸è¿‡è°¢è°¢ä½ æ¨èå¾—è¿™ä¹ˆè¯¦ç»†ã€‚', bot: 'ä¸å®¢æ°”ï½å¦‚æœåç»­éœ€è¦æŸ¥è¯¢ç«è½¦ç¥¨ã€é…’åº—ç©ºæˆ¿æˆ–æ›´å¤šæ¨èï¼Œæˆ‘éƒ½å¯ä»¥å¸®å¿™ã€‚ç¥æ‚¨å‡æœŸæ„‰å¿«å“¦ï¼ğŸ˜Š' }
        ];

        let currentStep = 0;
        // æ–°å¢æ ‡å¿—å˜é‡ï¼Œè·Ÿè¸ªæç¤ºæ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡
        let interactionHintShown = false;
        const chatContainer = document.getElementById('chat-container');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const scenarioPage = document.getElementById('scenario-page');
        const phoneContainer = document.getElementById('phone-container');
        const startChatButton = document.getElementById('start-chat');
        const interactionHint = document.getElementById('interaction-hint');
        const endChatModal = document.getElementById('end-chat-modal');
        const cancelEndChat = document.getElementById('cancel-end-chat');
        const confirmEndChat = document.getElementById('confirm-end-chat');

        // è‡ªåŠ¨è°ƒæ•´textareaé«˜åº¦
        function adjustTextareaHeight() {
            messageInput.style.height = 'auto';
            messageInput.style.height = (messageInput.scrollHeight) + 'px';
        }

        // æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯
        function addSystemMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'w-full flex justify-center my-2';
            messageDiv.innerHTML = `
                <div class="system-message">
                    ${message}
                </div>
            `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ˜¾ç¤ºåˆå§‹é—®å€™
        function showInitialGreeting() {
            const messageDiv = document.createElement('div');
            messageDiv.className = `my-2 mr-auto max-w-[80%]`;
            messageDiv.innerHTML = `
                  <div class="flex items-end">
                      <div class="chat-bubble-bot p-3 shadow-sm">
                          <p class="small-text">æ‚¨å¥½ï¼Œæˆ‘æ˜¯æ‚¨çš„AIæ—…æ¸¸åŠ©æ‰‹â€œå°æ—…â€ğŸ¤–ï¼Œå¯ä»¥ä¸ºæ‚¨æ¨èé€‚åˆçš„ç›®çš„åœ°ã€è¡Œç¨‹ä¸ä½å®¿å®‰æ’ï¼Œä¹Ÿèƒ½æä¾›æœºé…’é¢„è®¢ã€è¡Œç¨‹è§„åˆ’ã€ç¾é£Ÿæ”»ç•¥ç­‰æœåŠ¡ï¼Œè¯·é—®æ‚¨æœ‰ä»€ä¹ˆéœ€æ±‚ï¼Ÿ</p>                      
                      </div>
                  </div>
              `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // æ·»åŠ ç³»ç»Ÿæç¤º
            setTimeout(() => {
                addSystemMessage("æ¥ä¸‹æ¥ä¸ºæ‚¨æä¾›æœåŠ¡");
            }, 2000);
            
            // è®¾ç½®ç¬¬ä¸€ä¸ªç”¨æˆ·æ¶ˆæ¯
            setTimeout(() => {
                if (conversations.length > 0) {
                    messageInput.value = conversations[0].user;
                    adjustTextareaHeight();
                    
                    // åªåœ¨ç¬¬ä¸€æ¬¡æ˜¾ç¤ºäº¤äº’æç¤º
                    if (!interactionHintShown) {
                        setTimeout(() => {
                            interactionHint.classList.add('hint-visible');
                            interactionHintShown = true; // è®¾ç½®æ ‡å¿—ä¸ºå·²æ˜¾ç¤º
                        }, 500);
                    }
                }
            }, 4000); // å¢åŠ å»¶è¿Ÿæ—¶é—´ï¼Œè®©ç”¨æˆ·æœ‰è¶³å¤Ÿæ—¶é—´é˜…è¯»é—®å€™è¯­å’Œç³»ç»Ÿæç¤º
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessage(sender, message, isLast = false) {
            // éšè—äº¤äº’æç¤º
            interactionHint.classList.remove('hint-visible');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `my-2 ${sender === 'user' ? 'ml-auto' : 'mr-auto'} max-w-[80%]`;

            let bubbleClass = sender === 'user' ? 'chat-bubble-user' : 'chat-bubble-bot';

            // ç§»é™¤å¤´åƒ
            messageDiv.innerHTML = `
                  <div class="flex items-end ${sender === 'user' ? 'flex-row-reverse' : 'flex-row'}">
                      <div class="${bubbleClass} p-3 shadow-sm">
                          <p class="small-text">${formatMessage(message)}</p>
                      </div>
                  </div>
              `;

            // æ·»åŠ æ‰“å­—æŒ‡ç¤ºå™¨æ¨¡æ‹ŸåŠ è½½æ•ˆæœ
            if (sender === 'user') {
                // å‘é€åç«‹å³æ¸…ç©ºè¾“å…¥æ¡†
                messageInput.value = '';
                adjustTextareaHeight();
                
                addTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    chatContainer.appendChild(messageDiv);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 500); // ç”¨æˆ·æ¶ˆæ¯åŠ è½½å»¶è¿Ÿç¼©çŸ­ä¸º500ms
            } else if (sender === 'bot') {
                addTypingIndicator();
                setTimeout(() => {
                    removeTypingIndicator();
                    chatContainer.appendChild(messageDiv);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // å®¢æœå›å¤å®Œæˆåï¼Œæ˜¾ç¤ºä¸‹ä¸€æ¡ç”¨æˆ·æ¶ˆæ¯
                    if (currentStep < conversations.length) {
                        setTimeout(() => {
                            messageInput.value = conversations[currentStep].user;
                            adjustTextareaHeight();
                            
                            // ä¸å†æ˜¾ç¤ºäº¤äº’æç¤ºï¼Œå› ä¸ºå·²ç»æ˜¾ç¤ºè¿‡ä¸€æ¬¡
                        }, 1000);
                    } else {
                        messageInput.value = '';
                        messageInput.placeholder = 'å¯¹è¯å·²ç»“æŸ';
                        messageInput.disabled = true;
                        adjustTextareaHeight();
                        
                        // å»¶è¿Ÿ5ç§’æ˜¾ç¤ºç»“æŸå¯¹è¯æ¨¡æ€æ¡†
                        setTimeout(() => {
                            endChatModal.classList.add('modal-visible');
                        }, 5000); // 5000æ¯«ç§’ = 5ç§’
                    }
                }, 1000); // å®¢æœæ¶ˆæ¯åŠ è½½å»¶è¿Ÿç¼©çŸ­ä¸º1000ms
            }
        }

        // æ ¼å¼åŒ–æ¶ˆæ¯ï¼Œå¤„ç†æ¢è¡Œå’ŒåŠ ç²—
        function formatMessage(message) {
            // å¤„ç†æ¢è¡Œ
            let formatted = message.replace(/\n/g, '<br>');
            // å¤„ç†åŠ ç²—
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<span class="font-bold">$1</span>');
            // å¤„ç†åˆ—è¡¨
            formatted = formatted.replace(/^\s*\d+\.\s+(.*)$/gm, '<div class="flex items-start mb-1"><span class="mr-2 mt-0.5 font-medium">â€¢</span><span>$1</span></div>');
            return formatted;
        }

        // æ·»åŠ æ‰“å­—æŒ‡ç¤ºå™¨
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'my-2 mr-auto max-w-[80%]';
            typingDiv.id = 'typing-indicator';
            // ç§»é™¤å¤´åƒ
            typingDiv.innerHTML = `
                <div class="flex items-end">
                    <div class="chat-bubble-bot p-3 shadow-sm">
                        <div class="typing-indicator">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>
                    </div>
                </div>
            `;

            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // å¤„ç†ç”¨æˆ·è¾“å…¥
        function handleUserInput() {
            if (currentStep < conversations.length) {
                // éšè—äº¤äº’æç¤º
                interactionHint.classList.remove('hint-visible');
                
                const message = conversations[currentStep].user;
                addMessage('user', message);
                
                // æ¨¡æ‹Ÿå®¢æœå›å¤
                const conversation = conversations[currentStep];
                if (conversation.bot) {
                    const isLast = currentStep === conversations.length - 1;
                    setTimeout(() => {
                        addMessage('bot', conversation.bot, isLast);
                        currentStep++;
                    }, 1000);
                }
            }
        }

        // äº‹ä»¶ç›‘å¬
        // ç‚¹å‡»æ–‡æœ¬æ¡†å‘é€é¢„è®¾æ¶ˆæ¯
        messageInput.addEventListener('click', handleUserInput);

        // éšè—å‘é€æŒ‰é’®ï¼Œä¸ä½¿ç”¨å®ƒ
        sendButton.addEventListener('click', (e) => {
            e.preventDefault();
        });

        startChatButton.addEventListener('click', () => {
            scenarioPage.classList.add('hidden');
            phoneContainer.classList.remove('hidden');
            setTimeout(() => {
                showInitialGreeting();
            }, 100); // æ·»åŠ  100 æ¯«ç§’å»¶è¿Ÿï¼Œè®©é—®å€™è¯­é—ªå‡ºå‰æœ‰ä¸€ç‚¹æ—¶é—´
        });

        // æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
        // ç§»é™¤å–æ¶ˆæŒ‰é’®çš„äº‹ä»¶ç›‘å¬
        cancelEndChat.addEventListener('click', (e) => {
            e.stopPropagation(); // é˜»æ­¢äº‹ä»¶ä¼ æ’­
        });

        // å»¶è¿Ÿå…³é—­é¡µé¢çš„å‡½æ•°
        function delayedClose() {
            setTimeout(() => {
                try {
                    // å°è¯•å…³é—­çª—å£
                    window.close();
                } catch (e) {
                    // è‹¥å…³é—­å¤±è´¥ï¼Œå¯¼èˆªåˆ°ç©ºç™½é¡µé¢
                    document.body.innerHTML = '';
                    window.location.href = 'about:blank';
                }
            }, 1000); // å»¶è¿Ÿ 1 ç§’
        }

        confirmEndChat.addEventListener('click', () => {
            delayedClose();
            // ä¸ºé¿å…é¡µé¢æ®‹ç•™äº¤äº’ï¼Œæ¸…ç©ºé¡µé¢å†…å®¹
            document.body.innerHTML = '';
        });
    </script>
</body>

</html>
